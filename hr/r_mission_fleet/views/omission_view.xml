<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
<!-- Mission -->
		<record model="ir.ui.view" id="mission_fleet_form_view">
            <field name="name">mission.fleet.form</field>
            <field name="model">hr.mission</field>
            <field name="inherit_id" ref="r_mission.mission_form_view"/>
            <field name="arch" type="xml">
                <data>
                    <button name="action_done" position="replace">
                        <button name="action_print_autorisation" string="Imprimer l'autorisation" states="autorisation" class="btn-success" type="object"/>
                        <button name="action_autoriser_ok" string="Autoriser" states="autorisation" class="oe_highlight" type="object" groups="r_mission_fleet.group_mission_autorisation_fleet"/>
                        <button name="action_autoriser_nok" string="Refuser" states="autorisation"  class="btn-danger" type="object" groups="r_mission_fleet.group_mission_autorisation_fleet"/>
                        <button name="action_start" string="Sortie" states="planned" class="oe_highlight" type="object"/>
                        <button name="action_done" string="Retour et cloture" states="open" class="oe_highlight" type="object"/>
                    </button>
                    <xpath expr="//group[@name='main']" position="before">
                        <group colspan="4">
                            <field name="message" style="color:Red;" nolabel="1" states="autorisation"/>
                        </group>
                    </xpath>
                    <field name="moyen_id" position="after">
                        <field name="use_fleet" invisible="1"/>
                        <field name="autorisation" invisible="1"/>
                        <field name="vehicule_id" attrs="{'invisible': [('use_fleet', '=', False)]}"/>
                    </field>
                    <field name="company_id" position="after">
                        <field name="autorise_par_id" string="Autorisé par" attrs="{'invisible': ['|', ('autorisation', '=', False), ('state', 'in', ('draft', 'autorisation', 'cancel'))]}"/>
                        <field name="autorise_date" string="Autorisé le" attrs="{'invisible': ['|', ('autorisation', '=', False), ('state', 'in', ('draft', 'autorisation', 'cancel'))]}"/>
                    </field>
                    <field name="date_depart" position="replace">
                        <field name="date_depart_prevue" />
                        <field name="date_depart" states="open,done"/>
                        <field name="km_depart"   attrs="{'invisible': [('vehicule_id', '=', False)]}"/>
                    </field>
                    <field name="date_retour" position="replace">
                        <field name="date_retour_prevue" />
                        <field name="date_retour" states="done"/>
                        <field name="km_arrivee"  attrs="{'invisible': [('vehicule_id', '=', False)]}"/>
                    </field>
                    <page name="missionnaire_page" position="after">
                        <page string="Motif de refus" attrs="{'invisible': ['|', ('autorisation', '=', False), ('state', 'not in', ('cancel'))]}">
                            <group>
                                <group>
                                    <field name="autorise_par_id" string="Refusé par" />
                                    <field name="autorise_date" string="Refusé le" />
                                </group>
                            </group>
                            <field name="motif_refus"/>
                        </page>
                    </page>
                </data>

            </field>
        </record>

    </data>
</openerp>
