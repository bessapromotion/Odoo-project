<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="sale_report_view">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">

                <style>
                    .table, .table td, .table th {
                      border: 10px solid #ddd;
                      text-align: left;
                    }
                    .table {
                      border-collapse: collapse;
                      width: 100%;
                    }
                    .table th, .table td {
                      padding: 20px;
                    }
                    .salesperson{
                        padding: 50px
                    }
                </style>
                <div class="page">
                    <div class="oe_structure"/>
                    <p>Alger le : <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%d/%m/%Y')"/>
                    </p>
                    <center>
                        <b>
                            <h3>Ventes par commercial(e)</h3>
                        </b>
                    </center>
                    <center>
                        <b> <h4>Période</h4> </b>
                        <b>
                            <span t-esc="start_date" t-options='{"widget": "date"}'/>
                            A
                            <span t-esc="end_date" t-options='{"widget": "date"}'/>
                        </b>
                    </center>
                    <right>
                        <b>
                            <h5>Résumé par commercial(e)</h5>
                        </b>
                    </right>
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 15%;">Commercial(e)s</th>
                                <th style="width: 10%;">Nombre de vente</th>
                                <th style="width: 15%;">Montant Total</th>
                            </tr>
                        </thead>
                        <tr>
                            <t t-set="total_general" t-value="0"/>
                            <t t-set="sum_general" t-value="0"/>

                            <t t-foreach="data.keys()" t-as="commercial">
                                
                                <t t-set="com" t-value="0"/>
                                <t t-set="total_par_com" t-value="0"/>
                                <t t-set="sum_per_com" t-value="0"/>

                                <t t-foreach="data[commercial]" t-as="usr">
                                    <t t-set="total_par_com" t-value="total_par_com + usr[5]"/>
                                    <t t-set="sum_per_com" t-value="sum_per_com + 1"/>
                                </t>
                                    <t t-set="total_general" t-value="total_general + total_par_com"/>
                                    <t t-set="sum_general" t-value="sum_general + sum_per_com"/>
                                <tr>
                                    <td><t t-esc="commercial"/></td>
                                    <td style="text-align: right;padding:10px" ><t t-esc="sum_per_com"/></td>
                                    <!--td><t t-esc="total_par_com"/></td-->
                                    <td style="text-align: right;padding:10px">
                                        <span t-esc="'{0:,.2f}'.format(int(total_par_com)).replace(',', '&#160;').replace('.', ',')"  />
                                    </td>
                                </tr>
                            </t>
                            <tr>
                                <td style="text-align: right;padding:10px;font-weight: bold;">Total des ventes</td>
                                <td style="text-align: right;padding:10px;font-weight: bold;"><t t-esc="sum_general"/></td>
                                <td style="text-align: right;padding:10px;font-weight: bold;">
                                    <span t-esc="'{0:,.2f}'.format(int(total_general)).replace(',', '&#160;').replace('.', ',')"  />
                                </td>
                            </tr>
                        </tr>
                    </table>
                    <br/>
                    <right>
                        <b>
                            <h5>Détail des ventes</h5>
                        </b>
                    </right>
                    <t t-foreach="data.keys()" t-as="user">
                        <br/>
                        <center>
                            <b  class="salesperson">
                                <span>Commercial(e) :</span>
                                <span t-esc="user"/>
                            </b>
                        </center>
                        <t t-set="total_sum" t-value="0"/>
                        <t t-set="total_count" t-value="0"/>
                        <table>
                            <thead>
                                <tr>
                                    <th style="width: 15%;">Projet</th>
                                    <th style="width: 10%;">Dossier</th>
                                    <th style="width: 10%;">Date</th>
                                    <th style="width: 10%;">Etat</th>
                                    <th style="width: 30%;">Client</th>
                                    <th style="width: 10%;">Origine</th>
                                    <th style="width: 15%;">HT</th>
                                </tr>
                            </thead>    
                            <th>    
                                <tr t-foreach="data[user]" t-as="order">
                                    <td style="padding:10px;font-size:12px;">
                                        <span t-esc="order[1]"/>
                                    </td>
                                    <td style="padding:10px;font-size:12px;">
                                        <span t-esc="order[2]"/>
                                    </td>
                                    <td style="padding:10px;font-size:12px;">
                                        <span t-esc="order[3]" t-options='{"widget": "date"}'/>
                                    </td>
                                    <td style="padding:10px;font-size:12px;">
                                        <span t-esc="order[6]"/>
                                    </td>
                                    <td style="padding:10px;font-size:12px;">
                                        <span t-esc="order[4]"/>
                                    </td>
                                    <td style="padding:10px;font-size:12px;">
                                        <span t-esc="order[7]"/>
                                    </td>
                                    <td style="text-align: right;padding:10px;font-size:12px;">
                                        <span t-esc="'{0:,.2f}'.format(int(order[5])).replace(',', '&#160;').replace('.', ',')"  />
                                        <t t-set="total_sum" t-value="total_sum + order[5]"/>
                                        <t t-set="total_count" t-value="total_count + 1"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4">
                                    </td>
                                    <td style="text-align: right;padding:10px;">
                                        <b>Total</b>
                                    </td>
                                    <td style="text-align: center;padding:10px;">
                                        <span t-esc="total_count"/>
                                    </td>
                                    <td style="text-align: right;padding:10px;">
                                        <span t-esc="'{0:,.2f}'.format(int(total_sum)).replace(',', '&#160;').replace('.', ',')"  />
                                    </td>
                                </tr>
                            </th>
                        </table>
                    </t>
                </div>
            </t>
        </t>
    </template>

    <template id="sale_report_view_project">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">

                <style>
                    .table, .table td, .table th {
                      border: 10px solid #ddd;
                      text-align: left;
                    }
                    .table {
                      border-collapse: collapse;
                      width: 100%;
                    }
                    .table th, .table td {
                      padding: 20px;
                    }
                    .project{
                        padding: 50px
                    }
                </style>
                <div class="page">
                    <div class="oe_structure"/>
                    <p>Alger le : <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%d/%m/%Y')"/>
                    </p>
                    <center>
                        <b>
                            <h3>Ventes par project</h3>
                        </b>
                    </center>
                    <center>
                        <b> <h4>Période</h4> </b>
                        <b>
                            <span t-esc="start_date" t-options='{"widget": "date"}'/>
                            A
                            <span t-esc="end_date" t-options='{"widget": "date"}'/>
                        </b>
                    </center>

                    <right>
                        <b>
                            <h5>Résumé par Projet</h5>
                        </b>
                    </right>
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 15%;">Projets</th>
                                <th style="width: 10%;">Nombre de vente</th>
                                <th style="width: 15%;">Montant Total</th>
                            </tr>
                        </thead>
                        <tr>
                            <t t-set="total_general" t-value="0"/>
                            <t t-set="sum_general" t-value="0"/>

                            <t t-foreach="data.keys()" t-as="projets">
                                
                                <t t-set="prjt" t-value="0"/>
                                <t t-set="total_par_prjt" t-value="0"/>
                                <t t-set="sum_per_prjt" t-value="0"/>

                                <t t-foreach="data[projets]" t-as="projet">
                                    <t t-set="total_par_prjt" t-value="total_par_prjt + projet[5]"/>
                                    <t t-set="sum_per_prjt" t-value="sum_per_prjt + 1"/>
                                </t>
                                    <t t-set="total_general" t-value="total_general + total_par_prjt"/>
                                    <t t-set="sum_general" t-value="sum_general + sum_per_prjt"/>
                                <tr>
                                    <td><t t-esc="projets"/></td>
                                    <td style="text-align: right;padding:10px" ><t t-esc="sum_per_prjt"/></td>
                                    <!--td><t t-esc="total_par_prjt"/></td-->
                                    <td style="text-align: right;padding:10px">
                                        <span t-esc="'{0:,.2f}'.format(int(total_par_prjt)).replace(',', '&#160;').replace('.', ',')"  />
                                    </td>
                                </tr>
                            </t>
                            <tr>
                                <td style="text-align: right;padding:10px;font-weight: bold;">Total des ventes</td>
                                <td style="text-align: right;padding:10px;font-weight: bold;"><t t-esc="sum_general"/></td>
                                <td style="text-align: right;padding:10px;font-weight: bold;">
                                    <span t-esc="'{0:,.2f}'.format(int(total_general)).replace(',', '&#160;').replace('.', ',')"  />
                                </td>
                            </tr>
                        </tr>
                    </table>
                    <br/>
                    <right>
                        <b>
                            <h5>Détail des ventes</h5>
                        </b>
                    </right>
                    <t t-foreach="data.keys()" t-as="project">
                        <br/>
                        <center>
                            <b  class="project">
                                <span>Projet :</span>
                                <span t-esc="project"/>
                            </b>
                        </center>
                        <t t-set="total_sum" t-value="0"/>
                        <t t-set="total_count" t-value="0"/>
                        <table>
                            <thead>
                                <tr>
                                    <th style="width: 15%;">Projet</th>
                                    <th style="width: 10%;">Dossier</th>
                                    <th style="width: 10%;">Date</th>
                                    <th style="width: 10%;">Etat</th>
                                    <th style="width: 40%;">Client</th>
                                    <th style="width: 10%;">Origine</th>
                                    <th style="width: 15%;">HT</th>
                                </tr>
                            </thead>
                            <th>
                                <tr t-foreach="data[project]" t-as="order">
                                    <td style="padding:10px;font-size:12px;">
                                        <span t-esc="order[1]"/>
                                    </td>
                                    <td style="padding:10px;font-size:12px;">
                                        <span t-esc="order[2]"/>
                                    </td>
                                    <td style="padding:10px;font-size:12px;">
                                        <span t-esc="order[3]" t-options='{"widget": "date"}'/>
                                    </td>
                                    <td style="padding:10px;font-size:12px;">
                                        <span t-esc="order[6]"/>
                                    </td>
                                    <td style="padding:10px;font-size:12px;">
                                        <span t-esc="order[4]"/>
                                    </td>
                                    <td style="padding:10px;font-size:12px;">
                                        <span t-esc="order[7]"/>
                                    </td>
                                    <td style="text-align: right;padding:10px;font-size:12px;">
                                        <!--span t-esc="order[5]"/-->
                                        <span t-esc="'{0:,.2f}'.format(int(order[5])).replace(',', '&#160;').replace('.', ',')"  />
                                        <t t-set="total_sum" t-value="total_sum + order[5]"/>
                                        <t t-set="total_count" t-value="total_count + 1"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3">
                                    </td>
                                    <td style="text-align: right;padding:10px;">
                                        <b>Total</b>
                                    </td>
                                    <td style="text-align: center;padding:10px;">
                                        <span t-esc="total_count"/>
                                    </td>
                                    <td style="text-align: right;padding:10px;">
                                        <span t-esc="'{0:,.2f}'.format(int(total_sum)).replace(',', '&#160;').replace('.', ',')"  />
                                    </td>
                                </tr>
                            </th>
                        </table>
                    </t>
                </div>
            </t>
        </t>
    </template>

    <template id="paiement_rapport_view">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">

                <style>
                    .table, .table td, .table th {
                      border: 10px solid #ddd;
                      text-align: left;
                    }
                    .table {
                      border-collapse: collapse;
                      width: 100%;
                    }
                    .table th, .table td {
                      padding: 20px;
                    }
                    .mode_paiement{
                        padding: 50px
                    }
                </style>

                <div class="page">
                    <div class="oe_structure"/>
                    <p>Alger le : <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%d/%m/%Y')"/>
                    </p>
                    <center>
                        <b>
                            <h3>Paiement par mode</h3>
                        </b>
                    </center>
                    <center>
                        <b> <h4>Période</h4> </b>
                        <b>
                            <span t-esc="start_date" t-options='{"widget": "date"}'/>
                            A
                            <span t-esc="end_date" t-options='{"widget": "date"}'/>
                        </b>
                    </center>
                    <right>
                        <b>
                            <h5>Résumé des paiements</h5>
                        </b>
                    </right>
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 15%;">Mode de paiement</th>
                                <th style="width: 10%;">Nombre d'opérations</th>
                                <th style="width: 15%;">Montant Total</th>
                            </tr>
                        </thead>
                        <tr>
                            <t t-set="total_general" t-value="0"/>
                            <t t-set="sum_general" t-value="0"/>

                            <t t-foreach="data.keys()" t-as="op_mode">
                                
                                <t t-set="mode" t-value="0"/>
                                <t t-set="total_par_mode" t-value="0"/>
                                <t t-set="sum_per_mode" t-value="0"/>

                                <t t-foreach="data[op_mode]" t-as="paiement">
                                    <t t-set="total_par_mode" t-value="total_par_mode + paiement[8]"/>
                                    <t t-set="sum_per_mode" t-value="sum_per_mode + 1"/>
                                </t>
                                    <t t-set="total_general" t-value="total_general + total_par_mode"/>
                                    <t t-set="sum_general" t-value="sum_general + sum_per_mode"/>
                                <tr>
                                    <td><t t-esc="op_mode"/></td>
                                    <td style="text-align: right;padding:10px" ><t t-esc="sum_per_mode"/></td>
                                    <!--td><t t-esc="total_par_mode"/></td-->
                                    <td style="text-align: right;padding:10px">
                                        <span t-esc="'{0:,.2f}'.format(int(total_par_mode)).replace(',', '&#160;').replace('.', ',')"  />
                                    </td>
                                </tr>
                                

                            </t>
                            <tr>
                                <td style="text-align: right;padding:10px;font-weight: bold;">Total Général des paiements</td>
                                <td style="text-align: right;padding:10px;font-weight: bold;"><t t-esc="sum_general"/></td>
                                <td style="text-align: right;padding:10px;font-weight: bold;">
                                    <span t-esc="'{0:,.2f}'.format(int(total_general)).replace(',', '&#160;').replace('.', ',')"  />
                                </td>
                            </tr>
                        </tr>
                        
                    </table>
                    <br/>
                    <right>
                        <b>
                            <h5>Détail des paiements</h5>
                        </b>
                    </right>
                    <t t-foreach="data.keys()" t-as="op_mode">
                        <br/>
                        <center>
                            <b  class="mode_paiement">
                                <span>Mode de paiement :</span>
                                <span t-esc="op_mode"/>
                            </b>
                        </center>
                        <t t-set="total_sum" t-value="0"/>
                        <t t-set="total_count" t-value="0"/>
                        <table>
                            <thead>
                                <tr>
                                    <th style="width: 15%;">Projet</th>
                                    <th style="width: 5%;">N°</th>
                                    <th style="width: 10%;">Date</th>
                                    <th style="width: 25%;">Client</th>
                                    <th style="width: 20%;">Par</th>
                                    <th style="width: 10%;">N° Pièce</th>
                                    <th style="width: 20%;">Chargé</th>
                                    <th style="width: 12%;">Montant</th>
                                </tr>
                            </thead>
                            <th>    
                                <tr t-foreach="data[op_mode]" t-as="paiement">
                                    <td style="padding:10px;font-size:12px;">
                                        <span t-esc="paiement[1]"/>
                                    </td>
                                    <td style="padding:10px;font-size:12px;">
                                        <span t-esc="paiement[2]"/>
                                    </td>
                                    <td style="padding:10px;font-size:12px;">
                                        <span t-esc="paiement[3]" t-options='{"widget": "date"}' />
                                    </td>
                                    <td style="padding:10px;font-size:12px;">
                                        <span t-esc="paiement[4]"/>
                                    </td>
                                    
                                    <td style="padding:10px;font-size:12px;">
                                        <span t-esc="paiement[9]"/>
                                    </td>
                                    
                                    <td style="padding:10px;font-size:12px;">
                                        <span t-esc="paiement[6]"/>
                                    </td>
                                    <td style="padding:10px;font-size:12px;">
                                        <span t-esc="paiement[7]"/>
                                    </td>
                                    <td style="text-align: right;padding:10px;font-size:12px;">
                                        <span t-esc="'{0:,.2f}'.format(int(paiement[8])).replace(',', '&#160;').replace('.', ',')"  />
                                        <t t-set="total_sum" t-value="total_sum + paiement[8]"/>
                                        <t t-set="total_count" t-value="total_count + 1"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="5">
                                    </td>
                                    <td style="text-align: right;padding:10px;">
                                        <b>Total</b>
                                    </td>
                                    <td style="text-align: center;padding:10px;">
                                        <span t-esc="total_count"/>
                                    </td>
                                    <td style="text-align: right;padding:10px;">
                                        <span t-esc="'{0:,.2f}'.format(int(total_sum)).replace(',', '&#160;').replace('.', ',')"  />
                                    </td>
                                </tr>
                            </th>
                        </table>
                    </t>
                </div>
            </t>
        </t>
    </template>
</odoo>