<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <!--        recouvrement-->
    <record model="ir.ui.view" id="crm_reservation_graph_view">
        <field name="name">crm.reservation.graph</field>
        <field name="model">crm.reservation</field>
        <field name="type">graph</field>
        <field name="arch" type="xml">
            <graph string="Recouvrement" sample="1">
                <field name="partner_id"/>
                <field name="project_id"/>
                <field name="mode_achat" type="measure"/>
            </graph>
        </field>
    </record>
    <record model="ir.ui.view" id="crm_reservation_pivot_view">
        <field name="name">crm.reservation.pivot</field>
        <field name="model">crm.reservation</field>
        <field name="type">pivot</field>
        <field name="arch" type="xml">
            <pivot string="Recouvrement">
                <field name="partner_id"/>
                <field name="project_id"/>
                <field name="mode_achat"/>
            </pivot>
        </field>
    </record>
    <record id="crm_reservation_filtre_current_month_search_view" model="ir.ui.view">
        <field name="name">crm.reservation.search</field>
        <field name="model">crm.reservation</field>
        <field name="inherit_id" ref="crm_operation.view_crm_reservation_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//search" position="inside">
                <filter name="current_month_filter" string="Mois actual"
                        domain="[('create_date','&lt;',(context_today()+relativedelta(months=1)).strftime('%%Y-%%m-01')), ('create_date','&gt;=',time.strftime('%%Y-%%m-01'))]"/>
                <filter name="type_bien_apt" string="Appartement"
                        domain="[('type_bien','=','Appartement')]"/>
                <filter name="type_bien_apt_and_current_month" string="Appartement et Mois actual"
                        domain="[('type_bien','=','Appartement'),('create_date','&lt;',(context_today()+relativedelta(months=1)).strftime('%%Y-%%m-01')), ('create_date','&gt;=',time.strftime('%%Y-%%m-01'))]"/>


            </xpath>
        </field>
    </record>
    <record model="ir.actions.act_window" id="action_crm_tdb_analyse_rec_encaissemen_mode_achat">
        <field name="name">Encaissements par mode d'achat</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.order</field>
        <field name="view_mode">graph,pivot</field>
        <field name="domain">[('origin', 'not ilike', 'BAS')]</field>
        <field name="context">{'search_default_type_bien_apt_and_current_month': 1,'group_by': ['mode_achat'],
            'graph_measure':'mt_recouvrement',
            'graph_mode': 'bar',
            'graph_groupbys': ['mode_achat'],
            'pivot_measures': ['__count', 'mt_recouvrement']}
        </field>
    </record>
    <record model="ir.actions.act_window" id="action_crm_tdb_analyse_rec_charge_rcv">
        <field name="name">Réalisations par Chargées Recouvrement</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.order</field>
        <field name="view_mode">graph,pivot</field>
        <field name="context">{'search_default_type_bien_apt_and_current_month': 1,'group_by': ['charge_recouv_id'],
            'graph_measure':'mt_recouvrement',
            'graph_mode': 'bar',
            'graph_groupbys': ['charge_recouv_id'],
            'pivot_measures': ['__count', 'mt_recouvrement','objectif','taux_2']}
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_crm_tdb_analyse_vente_paiment_projet">
        <field name="name">Ventes par mode d'achat par projet</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.order</field>
        <field name="view_mode">pivot,graph</field>
        <field name="domain">[('origin', '!=', 'BAS')]</field>
        <field name="context">{'search_default_type_bien_apt_and_current_month': 1,'group_by': ['project_id'],
            'pivot_measures': ['__count', 'mt_recouvrement', 'amount_total'],
            'pivot_column_groupby': ['mode_achat'], 'pivot_row_groupby': ['project_id'],
            'orderedBy':[]
            }
        </field>
    </record>
    <record model="ir.actions.act_window" id="action_crm_tdb_analyse_recap_realisation_service">
        <field name="name">Récap des Réalisations par service</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">account.payment</field>
        <field name="view_mode">pivot,graph</field>
        <field name="domain">[('state', '=', 'posted')]</field>
        <field name="context">{'group_by': ['motif_paiement'],
            'pivot_measures':['__count','amount'],
            'orderedBy':
            []}
        </field>
    </record>
    <record model="ir.actions.act_window" id="action_crm_tdb_analyse_rar_dmd_rar_global">
        <field name="name">RAR Demandé et RAR Global par projet</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.order</field>
        <field name="view_mode">pivot,graph</field>
        <field name="context">{'search_default_type_bien_apt_and_current_month': 1,
            'group_by': ['project_id'],
            'pivot_measures':
            ['__count','amount_total','valeur_ttc','valeur_ttc2','total_tva','tva_paye','mt_paye','mt_reste'],
            'pivot_row_groupby': ['project_id'],
            'orderedBy':[]
            }
        </field>
    </record>
    <!--    !notaire-->
    <record model="ir.actions.act_window" id="action_crm_tdb_analyse_realisation_rcv_exe">
        <field name="name">Réalisations Recouvrement par Exercice</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.order</field>
        <field name="view_mode">graph,pivot</field>
        <field name="context">{'search_default_type_bien_apt_and_current_month': 1,'group_by': ['validity_date:year'],
            'graph_measure': 'mt_recouvrement',
            'graph_mode': 'line',
            'graph_groupbys': ['validity_date:year']}
        </field>
    </record>
    <record model="ir.actions.act_window" id="action_crm_tdb_analyse_realisation_rcv_det">
        <field name="name">Réalisations Recouvrement détaillé</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.order</field>
        <field name="view_mode">graph,pivot</field>
        <field name="context">{'search_default_current_year_filter': 1'group_by': ['validity_date:month'],
            'graph_measure': 'mt_recouvrement',
            'graph_mode': 'line',
            'graph_groupbys': ['validity_date:month']}
        </field>
    </record>
    <record model="ir.actions.act_window" id="action_crm_tdb_analyse_detail_dossier">
        <field name="name">Détail dossiers en cours de traitement</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.order</field>
        <field name="view_mode">pivot,graph</field>
        <field name="view_id" ref="view_sale_order_graph2"/>
        <field name="search_view_id" ref="sale.view_sales_order_filter"/>
        <field name="domain">[('mode_achat', '=', '2')]</field>
        <field name="context">{
            'search_default_type_bien_apt_and_current_month': 1,
            'group_by': ['simulation_id'],
            'graph_mode': 'bar',
            'pivot_measures': ['__count','simulation_montant'],
            'graph_groupbys': ['simulation_id'],
            'graph_measure': 'mt_recouvrement'}
        </field>
    </record>
</odoo>