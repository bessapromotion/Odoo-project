<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>


        <record id="view_order_project1_form" model="ir.ui.view">
            <field name="name">sale.order.project1.form</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                <button name="action_confirm" position="replace">
                    <button name="action_confirm1" id="action_confirm1"
                        string="Confirmer" class="btn-primary" type="object"
                        attrs="{'invisible': [('state', 'not in', ['sent'])]}"
                            confirm="Voulez-vous confirmer la commande ?"
                    />
                </button>
                <button name="action_confirm" position="replace">
                    <button name="action_confirm"
                        string="Confirmer" type="object"
                        attrs="{'invisible': [('state', 'not in', ['draft'])]}"
                            confirm="Voulez-vous confirmer la commande ?"
                    />
                </button>

                <button name="action_cancel" position="replace">
                    <button name="action_cancel"
                        string="Annuler" type="object"
                            confirm="Voulez-vous annuler la commande ?" states="draft,sent,sale,done"
                    />
                </button>

                <xpath expr="//field[@name='partner_id']" position="after">
                    <field name="mode_achat"/>
                    <field name="project_id"/>
                    <field name="create_auto" invisible="1"/>
                    <field name="charge_recouv_id"/>
                </xpath>
                 <xpath expr="//field[@name='partner_id']" position="before">
                    <field name="num_dossier"/>
                </xpath>
                <!--xpath expr="//field[@name='payment_term_id']" position="after">
                    <field name="montant_declare"/>
                </xpath-->
                 <xpath expr="//field[@name='partner_id']" position="attributes">
                    <attribute name="options">{"no_create": True}</attribute>
                </xpath>
                 <xpath expr="//field[@name='order_line']" position="attributes">
                    <attribute name="context">{"default_project_id": project_id}</attribute>
                </xpath>

                <xpath expr="//notebook/page/field[@name='order_line']/tree/field[@name='product_id']" position="before">
                    <field name="project_id" invisible="1"/>
                </xpath>
                <xpath expr="//notebook/page/field[@name='order_line']/tree/field[@name='product_id']" position="attributes">
                    <attribute name="domain">['&amp;', ('project_id', '=', project_id),('etat', 'in' , ('Libre', 'Pré-Réservé'))]</attribute>
                    <attribute name="options">{"no_create": True}</attribute>
                </xpath>

                 <!--<xpath expr="//notebook/page/field[@name='order_line']/tree/field[@name='price_total']" position="after">-->
                    <!--<button name="action_compute_price2" string="calculer PU" type="object"  states="draft, sent"  icon="fa-magic" />-->
                <!--</xpath>-->
                <xpath expr="//notebook/page/field[@name='order_line']/tree/field[@name='price_unit']" position="before">
                    <field name="num_lot"/>
                    <field name="type_id"/>
                    <field name="format_id"/>
                    <field name="orientation"/>
                    <field name="superficie"/>
                    <field name="prix_m2"/>
                </xpath>

            </field>
        </record>


    </data>
</openerp>
